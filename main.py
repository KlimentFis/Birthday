from datetime import datetime
from pyrogram import Client
from random import shuffle
from config import api_id, api_hash
import os

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
app = Client(
    "my_account",  # –ò–º—è —Å–µ—Å—Å–∏–∏
    api_id=api_id,
    api_hash=api_hash
)

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
LOG_FILE = "sent_log.txt"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å –ª–æ–≥–æ–º, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –µ–≥–æ
if not os.path.exists(LOG_FILE):
    open(LOG_FILE, "w").close()

# –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (ID –∏ –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
users = {
    "–ì—É–ª—å": {"id": 1, "gender": "–∂", "dob": "1990-07-02"},
    "–†—É—Å": {"id": 2, "gender": "–º", "dob": "1985-08-19"},
    "–†–∏–º": {"id": 3, "gender": "–∂", "dob": "1992-08-22"},
    "–ñ–µ–∫": {"id": 4, "gender": "–º", "dob": "1993-07-27"},
    "–î–∞–Ω—å": {"id": 5, "gender": "–º", "dob": "1987-08-14"},
    "–°–≤–µ—Ç": {"id": 6, "gender": "–∂", "dob": "1995-09-02"},
    "–ê—Ä—Ç—É—Ä": {"id": 7, "gender": "–º", "dob": "1980-02-10"},
    "–ö–æ—Å—Ç—å": {"id": 8, "gender": "–º", "dob": "1998-06-15"},
    "–Ø–Ω": {"id": 9, "gender": "–∂", "dob": "1991-06-30"},
    "–õ—é–±–∏–º–∞—è –∫—Ä–µ—Å—Ç–Ω–∞—è": {"id": 10, "gender": "–∂", "dob": "1983-11-10"},
    "–í–æ–≤": {"id": 11, "gender": "–º", "dob": "1992-03-31"},
    "–ú–∞–º": {"id": 12, "gender": "–∂", "dob": "1970-09-23"},
    "–Ø": {"id": 13, "gender": "–º", "dob": "1970-09-27"},
    "–í–∞–ª—å": {"id": 14, "gender": "–∂", "dob": "1994-12-28"},
    "–¢–∞–Ω—å": {"id": 15, "gender": "–∂", "dob": "1988-06-19"},
    "–í–∏–∫": {"id": 16, "gender": "–∂", "dob": "1993-01-10"},
    "–ê–ª–∏–Ω": {"id": 17, "gender": "–∂", "dob": "1990-01-17"},
    "–í–∏–æ–ª–µ—Ç—Ç": {"id": 18, "gender": "–∂", "dob": "1993-01-10"},
    "–¢—ë–º–∞": {"id": 19, "gender": "–º", "dob": "2000-02-09"},
}

# –®–∞–±–ª–æ–Ω—ã –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
greetings = [
    "{}, –ø–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å –±—É–¥–µ—Ç –º–Ω–æ–≥–æ —è—Ä–∫–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π! üéâ",
    "–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, {}! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –ø–æ–ª–æ–Ω —Å—á–∞—Å—Ç—å—è, —É–¥–∞—á–∏ –∏ –ø—Ä–∏—è—Ç–Ω—ã—Ö —Å—é—Ä–ø—Ä–∏–∑–æ–≤! üå∏",
    "–ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º, {}! –ü—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–¥–æ—Å—Ç—å—é, –ª—é–±–æ–≤—å—é –∏ —Ç–µ–ø–ª–æ–º! üåü",
    "{}, –ø–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —ç—Ç–∏–º –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–º –¥–Ω—ë–º! –ü—É—Å—Ç—å –≤–ø–µ—Ä–µ–¥–∏ –∂–¥—ë—Ç —Ç–æ–ª—å–∫–æ –ª—É—á—à–µ–µ! üéÇ",
    "–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, {}! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–µ–±–µ —Ä–∞–¥–æ—Å—Ç—å –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ! ü•≥",
    "–ñ–µ–ª–∞—é —Ç–µ–±–µ —Å–∞–º—ã—Ö —Å–≤–µ—Ç–ª—ã—Ö –∏ —Ç—ë–ø–ª—ã—Ö –¥–Ω–µ–π, {}! –ü—É—Å—Ç—å —Å–±—É–¥–µ—Ç—Å—è –≤—Å—ë, –æ —á—ë–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å! üíñ",
    "–° –¥–Ω—é—Ö–æ–π, {}! –ü—É—Å—Ç—å –≤–ø–µ—Ä–µ–¥–∏ —Ç–æ–ª—å–∫–æ —è—Ä–∫–∏–µ —Å–æ–±—ã—Ç–∏—è, –∞ —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç –ø–æ–ª–Ω–∞ —É–¥–∞—á–∏ –∏ —Ä–∞–¥–æ—Å—Ç–∏! ‚ú®",
    "–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, {}! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤—ã—Ö, —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –∂–∏–∑–Ω–∏! üå∫",
    "{}, –ø–æ–∑–¥—Ä–∞–≤–ª—è—é! –ü—É—Å—Ç—å —Å–±—É–¥–µ—Ç—Å—è –≤—Å—ë, –æ —á—ë–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å, –∏ –ø—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–æ–π –∏ —É—Å–ø–µ—à–Ω–æ–π! üåà",
    "–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, {}! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç —Ç–µ–±–µ —Ç–æ–ª—å–∫–æ —Å—á–∞—Å—Ç—å–µ, —Ä–∞–¥–æ—Å—Ç—å –∏ –º–æ—Ä–µ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è! üåª",
]

# –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
today = datetime.today()
today_date = today.strftime('%Y-%m-%d')

# –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
if os.path.exists(LOG_FILE):
    with open(LOG_FILE, "r") as log:
        already_congratulated = log.read().splitlines()
else:
    already_congratulated = []

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ª–æ–≥–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–æ–≤—ã—Ö –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
with open(LOG_FILE, "a") as log:
    for name, info in users.items():
        # –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–Ω –µ—â—ë –Ω–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω
        if info["dob"] == today_date and name not in already_congratulated:
            # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–º–µ–Ω–∏
            shuffle(greetings)
            # –í—ã–±–∏—Ä–∞–µ–º –æ–¥–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è)
            message = greetings[0].format(name)

            # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ pyrogram
            with app:
                app.send_message(info["id"], message)
                print(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {name}: {message}")

            # –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω
            log.write(name + "\n")

# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞ –≤ –∫–æ–Ω—Ü–µ –≥–æ–¥–∞
if today.month == 12 and today.day == 31:
    if os.path.exists(LOG_FILE):
        os.remove(LOG_FILE)
        print(f"–õ–æ–≥-—Ñ–∞–π–ª {LOG_FILE} —É–¥–∞–ª—ë–Ω –≤ –∫–æ–Ω—Ü–µ –≥–æ–¥–∞.")